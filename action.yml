name: CodeSniffer
author: discoverygarden
description: Runs static analysis on your PHP code.

inputs:
  path:
    description: The path (or paths) to run the analysis on.
    required: false
    default: ./
  extensions:
    description: Comma separated list of file extensions to test.
    required: false
    default: php,module,inc,install,test,profile,theme,css,info,md,yml
  suffix:
    description: Comma separated list of file extensions to test used by phpcs.
    required: false
    default: .php,*.module,*.inc,*.install,*.test,*.profile,*.theme,*.js,*.css,*.info
  lint:
    description: Comma separated list of file extentions to lint.
    required: false
    default: php,module,inc,install,test
  phpcs-ignore:
    description: Comma separated list of files to ignore.
    required: false
    default: "*.md"
  phpcpd-exclude:
    description: Comma separated list of files to ignore.
    required: false
  syntax-continue:
    description: Flag to allow workflow to pass on Syntax step failure.
    required: false
    default: false
  standards-continue:
    description: Flag to allow workflow to pass on Standards step failure.
    required: false
    default: false
  phpcpd-continue:
    description: Flag to allow workflow to pass on PHPCPD step failure.
    required: false
    default: false

runs:
  using: "composite"
  steps:
    - name: Installing Lint requirements
      shell: bash
      run: composer install
      working-directory: ${{ github.action_path }}
    - name: Syntax
      shell: bash
      continue-on-error: ${{ inputs.syntax-continue }}
      run: >
        ${{ github.action_path }}/vendor/bin/phpcs --standard=Generic --sniffs=Generic.PHP.Syntax
        --extensions=${{ inputs.lint }} ${{ inputs.path }}
    - name: Standards
      shell: bash
      if: always()
      continue-on-error: ${{ inputs.standards-continue }}
      run: >
        ${{ github.action_path }}/vendor/bin/phpcs -s --standard=Drupal,DrupalPractice
        --extensions=${{ inputs.extensions }} ${{ inputs.path }} --ignore=${{ inputs.phpcs-ignore }}
    - name: Copy-Pasta - Exclude
      shell: bash
      if: ${{ always() && inputs.phpcpd-exclude != '' }}
      continue-on-error: ${{ inputs.phpcpd-continue }}
      run: >
        ${{ github.action_path }}/vendor/bin/phpcpd --suffix=${{ inputs.suffix }}
        --exclude=${{ inputs.phpcpd-exclude }} ${{ inputs.path }}
    - name: Copy-Pasta - Normal
      shell: bash
      if: ${{ always() && inputs.phpcpd-exclude == '' }}
      continue-on-error: ${{ inputs.phpcpd-continue }}
      run: >
        ${{ github.action_path }}/vendor/bin/phpcpd --suffix=${{ inputs.suffix }} ${{ inputs.path }}

branding:
  icon: 'check-square'
  color: 'blue'
